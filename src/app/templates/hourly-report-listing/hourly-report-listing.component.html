<!-- HEADER -->

<app-header></app-header>

<!-- HEADER -->

<div *ngIf=filterLoader class="main-lds-ring-div">
  <!-- <div class="lds-ring">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div> -->
  <img src="../../../assets/images/infinity_loader.gif">
</div>

<div class="row main_count_header" [ngStyle]="{'padding-left': isSidebarHovered ? '16.5rem' : '5rem'}">
  <div class="col-12 pt-2">
    <div class=" btn-group btn-group-toggle float-right">

      <span>

        <label class=" btn btn-sm btn-danger btn-simple ml-2" routerLink="/hourly-report-listing"
          [queryParams]="{today: 1,execid:execid, execname:execname,fromtime:fromTime,totime:toTime,status:status,from:fromDate,to:toDate}"
          [ngClass]="{'active':clicked===true}">
          <input class=" d-none d-sm-none" name="options" type="radio" />
          <span class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
            Today
          </span>
          <span class=" d-block d-sm-none">
            <i class=" tim-icons icon-gift-2"> </i>
          </span>
        </label>

        <label class=" btn btn-sm btn-danger btn-simple ml-2" routerLink="/hourly-report-listing"
          [queryParams]="{last7: 1,execid:execid, execname:execname,fromtime:fromTime,totime:toTime,status:status,from:fromDate,to:toDate}"
          [ngClass]="{'active':clicked1===true}">
          <input class=" d-none" name="options" type="radio" />

          <span class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
            Last 7 days
          </span>
          <span class=" d-block d-sm-none">
            <i class=" tim-icons icon-tap-02"> </i>
          </span>
        </label>

        <label class=" btn btn-sm btn-danger btn-simple mx-2" [ngClass]="{'active':clicked2===true}">
          <div #nextActionDates class="cursor-pointer d-none">
            <i class="fas fa-filter" style="color: white;"></i>&nbsp;
          </div>
          <span id="nextActionDates" class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
            {{datecustomfetch}}
          </span>
          <span class=" d-block d-sm-none">
            <i class=" tim-icons icon-tap-02"> </i>
          </span>
        </label>

      </span>

      <span>
        <button type="button" class="btn btn-warning buttonwithicon p-1" (click)="refresh()"><i
            class="fas fa-redo"></i>Reset</button>
      </span>

    </div>
  </div>
</div>

<div class="body-cntnts dimmable blurring d-flex" [ngStyle]="{'padding-left': isSidebarHovered ? '14rem' : '3rem'}">

  <div class="p-0 listof_times d-flex flex-column">

    <a class="text-center py-3 time_zone overall_day cursor-pointer border-bot active"
      (click)="selectedTimeZone('overall')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>Overall</span>
    </a>
    <a class="text-center py-3 time_zone overall_day cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>Overall</span>
    </a>

    <a class="text-center py-3 time_zone before9_day cursor-pointer border-bot" (click)="selectedTimeZone('before9')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>Before 9:30AM</span>
    </a>
    <a class="text-center py-3 time_zone before9_day cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>Before 9:30AM</span>
    </a>

    <a class="text-center py-3 time_zone time_list cursor-pointer border-bot" (click)="selectedTimeZone('09:30')"
      *ngIf="(fromDate == toDate && (execid == '' || execid == undefined || execid == null))">
      <span>9:30AM - 10:30AM</span>
    </a>
    <a class="text-center py-3 time_zone time_list cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>9:30AM - 10:30AM</span>
    </a>

    <a class="text-center py-3 time_zone time_list1 cursor-pointer border-bot" (click)="selectedTimeZone('10:30')"
      *ngIf="(fromDate == toDate && (execid == '' || execid == undefined || execid == null))">
      <span>10:30AM - 11:30AM</span>
    </a>
    <a class="text-center py-3 time_zone time_list1 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>10:30AM - 11:30AM</span>
    </a>

    <a class="text-center py-3 time_zone time_list2 cursor-pointer border-bot" (click)="selectedTimeZone('11:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>11:30AM - 12:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list2 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>11:30AM - 12:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list3 cursor-pointer border-bot" (click)="selectedTimeZone('12:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>12:30PM - 1:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list3 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>12:30PM - 1:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list4 cursor-pointer border-bot" (click)="selectedTimeZone('1:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>1:30PM - 2:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list4 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>1:30PM - 2:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list5 cursor-pointer border-bot" (click)="selectedTimeZone('2:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>2:30PM - 3:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list5 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>2:30PM - 3:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list6 cursor-pointer border-bot" (click)="selectedTimeZone('3:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>3:30PM - 4:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list6 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>3:30PM - 4:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list7 cursor-pointer border-bot" (click)="selectedTimeZone('4:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>4:30PM - 5:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list7 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>4:30PM - 5:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list8 cursor-pointer border-bot" (click)="selectedTimeZone('5:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>5:30PM - 6:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list8 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>5:30PM - 6:30PM</span>
    </a>

    <a class="text-center py-3 time_zone time_list9 cursor-pointer border-bot" (click)="selectedTimeZone('6:30')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>6:30PM - 7:30PM</span>
    </a>
    <a class="text-center py-3 time_zone time_list9 cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>6:30PM - 7:30PM</span>
    </a>

    <a class="text-center py-3 time_zone after7_day cursor-pointer border-bot" (click)="selectedTimeZone('after7')"
      *ngIf="fromDate == toDate && (execid == '' || execid == undefined || execid == null)">
      <span>After 7:30PM</span>
    </a>
    <a class="text-center py-3 time_zone after7_day cursor-pointer border-bot"
      *ngIf="fromDate != toDate || (execid != '' && execid != undefined && execid != null)" data-toggle="tooltip"
      data-placement="right" title="Time Selection not Allowed"
      [ngClass]="{'blurred' : fromDate != toDate || (execid != '' && execid != undefined && execid != null)}">
      <span>After 7:30PM</span>
    </a>

  </div>

  <div class="enquiry_content_main" style="padding-inline: 8px !important;">
    <!-- this is the table for assigned leads -->
    <div class="table-container ">

      <div id="filtermaindiv" class="filterspan ml-2">
        <span *ngIf="sourceFilter && source != ''">
          <div class="p-2 chip">
            {{source == 'GR - Microsite' ? 'GR - campaign' : source}}
            <span class="closebtn" (click)="sourceClose()">&times;</span>
          </div>
        </span>

        <span *ngIf="executivefilterview && execid != '' && (roleid == 1 || roleid == '2')">
          <div class="p-2 chip">
            {{execname}}
            <span class="closebtn" (click)="executiveclose()">&times;</span>
          </div>
        </span>

        <span *ngIf="stageFilter == true && status  != ''">
          <div class="p-2 chip">
            {{status}}
          </div>
        </span>
      </div>

      <div class="CSassigned_table" #scrollContainer>
        <div class="crm-sub-container padding-medium-full">
          <div class="panel-1 crm-auto-scrollrm panel-content">
            <table #scrollContainer class="content_table_main table table-bordered" infinite-scroll [fromRoot]="true"
              [scrollWindow]="false" [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50"
              (scrolled)="loadMoreassignedleads()" [infiniteScrollContainer]="'.CSassigned_table'">
              <thead>
                <tr class="header">
                  <!-- ----------------------------sl no---------------------------- -->
                  <th class="text-center">#</th>

                  <!-- ----------------------------Name---------------------------- -->
                  <th>Name </th>

                  <!-- ----------------------------source with filter--------------------------- -->
                  <th *ngIf="roleid == '1' || roleid == '2'">
                    <div class="d-flex justify-content-between">
                      <span>Source</span>
                      <div>
                        <button class="btn btn-warning" type="button" id="bookingLeadDropdown_source"
                          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                          style="padding: 0px 5px !important;">
                          <i class="fas fa-filter" style="color: white;"></i>
                        </button>
                        <div class="dropdown-menu propertyBasedFilter p-0" aria-labelledby="bookingLeadDropdown_source"
                          style="cursor:pointer; max-height: 250px;max-width: 250px;; overflow-y: auto;">
                          <!-- Filter Search  input -->
                          <input type="text" class="form-control sourcesearch" placeholder="Search..."
                            [(ngModel)]="searchTerm_source" (input)="filtersource()"
                            style="margin-bottom: 2px;position: sticky;z-index: 1;top: 0;">
                          <!-- Dropdown items with checkboxes -->
                          <div class="source_list_checkbox">
                            <div *ngFor="let sourcelist of sourceList">
                              <label class="dropdown-item dropDownCursor mb-1">
                                <input type="checkbox" class="mr-2 loopcheckbox hidesourcecheckbox"
                                  id="hidesourcecheckboxid" value="{{sourcelist?.source}}" name='sourceFilter'
                                  (change)="onCheckboxChangesource()">
                                {{ sourcelist.source }}
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </th>

                  <!-- stage  -->
                  <th>
                    <div class="d-flex justify-content-between">
                      <span>Stage</span>
                      <div>
                        <button class="btn btn-warning" type="button" id="bookingLeadDropdown_source"
                          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                          style="padding: 0px 5px !important;">
                          <i class="fas fa-filter" style="color: white;"></i>
                        </button>
                        <div class="dropdown-menu propertyBasedFilter p-0" aria-labelledby="bookingLeadDropdown_source"
                          style="cursor:pointer; max-height: 250px;max-width: 250px;; overflow-y: auto;">
                          <!-- Filter Search  input -->
                          <input type="text" class="form-control stagesearch" placeholder="Search..."
                            [(ngModel)]="searchTerm_stage" (input)="filterstage()"
                            style="margin-bottom: 2px;;position: sticky;z-index: 1;top: 0;">
                          <!-- Dropdown items with checkboxes -->
                          <div class="stage_list_checkbox">
                            <div *ngFor="let stage of stageList">
                              <label class="dropdown-item dropDownCursor mb-1">
                                <span (click)="onCheckboxChangestage(stage?.value)"> {{ stage.name }}</span>
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </th>

                  <!-- ----------------------------Assigned to(RM)---------------------------- -->
                  <th *ngIf="roleid == '1' || roleid == '2'">
                    <div class="d-flex justify-content-between">
                      <span>Assignees</span>
                      <div>
                        <button class="btn btn-warning" type="button" id="executiveDropdown" data-toggle="dropdown"
                          aria-haspopup="true" aria-expanded="false" style="padding: 0px 5px !important;">
                          <i class="fas fa-filter" style="color: white;"></i>
                        </button>
                        <div class="dropdown-menu propertyBasedFilter p-0" aria-labelledby="executiveDropdown"
                          style="cursor:pointer; max-height: 250px;max-width: 250px;overflow-y: auto;">
                          <!-- Filter Search  input -->
                          <div class="dropdown-search-container" style="position: sticky;z-index: 1;top: 0;">
                            <input type="text" class="form-control executivesearch" placeholder="Search..."
                              [(ngModel)]="searchTerm_executive" (input)="filterExecutive()"
                              style="margin-bottom: 2px;">
                          </div>
                          <!-- Dropdown items with checkboxes -->
                          <div *ngIf="retailExecutives?.length">
                            <div class="exec_list_checkbox">
                              <div *ngFor="let exec of retailExecutives">
                                <label class="dropdown-item dropDownCursor mb-1">
                                  <input type="checkbox" class="mr-2 loopcheckbox hideExecutivecheckbox"
                                    id="hideExecutivecheckboxid" value="{{exec?.ID}}" name='executiveFilter'
                                    (change)="onCheckboxExecutiveChange()">
                                  {{ exec.Name }}
                                </label>
                              </div>
                            </div>
                          </div>
                          <div *ngIf="!retailExecutives?.length" class="text-center" style="color: #666666;">
                            <h4>No Executives Found</h4>
                          </div>
                        </div>
                      </div>
                    </div>
                  </th>

                  <!-- ----------------------------Lastest remarks---------------------------- -->
                  <th class="">Latest Remarks</th>
                </tr>
              </thead>
              <tbody *ngIf="callerleads?.length" class="enquiry_table_body">
                <tr *ngFor="let leads of callerleads; let i = index">
                  <!-- ----------------------------Sl.no---------------------------- -->
                  <td style="text-align: center;width: 3%;">
                    {{i+1}}</td>
                  <!-- ----------------------------Sl.no---------------------------- -->

                  <!-- ----------------------------Customer name and number---------------------------- -->
                  <td>
                    <a class="btn_style cursor-pointer">
                      <div class="statuscard">{{leads.custName}}</div>
                      <div>
                        {{leads.custNumber}}</div>
                    </a>
                  </td>

                  <!-- ----------------------------Lead source---------------------------- -->
                  <td *ngIf="roleid == '1' || roleid == '2'">
                    {{(leads.custSource == 'GR - Microsite' ? 'GR - campaign' : leads.custSource)}}
                  </td>
                  <!-- ----------------------------Lead source---------------------------- -->

                  <td>{{leads.stage}}</td>

                  <!-- ----------------------------Assigned-Executive-Name---------------------------- -->
                  <td *ngIf="roleid == '1' || roleid == '2'">
                    {{leads.execName}}</td>
                  <!-- ----------------------------Assigned-Executive-Name---------------------------- -->

                  <!------------------------------Latest Remarks Fetch Section------------------------------>
                  <td class="">
                    <!-- <div *ngFor="let remarksarray of leads.latestremarks"
                      style="overflow: hidden;white-space: normal;width: 200px !important;"> -->
                    <div style="word-wrap: break-word;">{{leads.remarks}}</div>
                    <!-- <hr class="m-0" *ngIf="remarksarray.visitremarks && remarksarray.manualremarks"
                        [ngStyle]="{'background': (todaysdateforcompare > leads?.nextactiondate && (normalcallparam || usvparam || svparam || rsvparam || fnparam)) ? 'white' : '#999' }">
                      <span style="word-wrap: break-word;">{{remarksarray.manualremarks}}</span> -->
                    <!-- </div> -->
                  </td>
                  <!------------------------------Latest Remarks Fetch Section------------------------------>

                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Followup Sections Table -->
        <div class="text-center lead_norecord" *ngIf="!callerleads?.length">
          No Leads Found.....
        </div>
      </div>

    </div>
  </div>

</div>