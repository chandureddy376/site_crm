<body class="g-sidenav-show" style="background-color: #F9FAFB;overflow: hidden;">

  <app-header></app-header>

  <main class="main-content max-height-vh-100 h-100 border-radius-lg" style="margin-top: 2.5rem;"
    [ngStyle]="{'margin-left': isSidebarHovered ? '14rem' : '2.5rem'}">

    <div class="container-fluid pb-2" style="padding-inline:  1.5rem !important;">
      <div class="row">
        <div class="col-xl-12 col-sm-12 mb-xl-2 mb-2">

          <div class=" btn-group btn-group-toggle float-left align-items-baseline">
            <div class="mr-3">
              <select id="project_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3"
                (change)="propchange($event)">
                <option value="">Select Project</option>
                <option *ngFor="let projects of mandateprojects" value="{{projects.property_idfk}}"
                  [selected]="projects.property_idfk == propertyid">{{projects.property_info_name}}</option>
              </select>
            </div>
          </div>

          <div class=" btn-group btn-group-toggle float-right align-items-center gap-3">
            <!-- <span>
              <label class=" btn btn-sm btn-danger btn-simple m-0" routerLink="/mandate-dashboard"
                [queryParams]="{allvisits: 1,from:'', to:'',property:propertyid, propname:propertyname, execid:execid, execname:execname, stage:stagevalue, stagestatus:stagestatusval, team:team,dashtype:'dashboard',htype:'mandate'}"
                [ngClass]="{'active':clicked===true}">
                <input checked="checked" class=" d-none d-sm-none" name="options" type="radio" />

                <span class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
                  All Time
                </span>
                <span class=" d-block d-sm-none">
                  <i class=" tim-icons icon-single-02"> </i>
                </span>
              </label>
              <label class=" btn btn-sm btn-danger btn-simple ml-1 m-0" routerLink="/mandate-dashboard"
                [queryParams]="{todayvisited: 1,from:'', to:'',property:propertyid, propname:propertyname, execid:execid, execname:execname, stage:stagevalue, stagestatus:stagestatusval, team:team,dashtype:'dashboard',htype:'mandate'}"
                [ngClass]="{'active':clicked1===true}">
                <input class=" d-none d-sm-none" name="options" type="radio" />
                <span class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
                  Today
                </span>
                <span class=" d-block d-sm-none">
                  <i class=" tim-icons icon-gift-2"> </i>
                </span>
              </label>
              <label class=" btn btn-sm btn-danger btn-simple ml-1 m-0" routerLink="/mandate-dashboard"
                [queryParams]="{yesterdayvisited: 1,from:'', to:'',property:propertyid, propname:propertyname, execid:execid, execname:execname, stage:stagevalue, stagestatus:stagestatusval, team:team,dashtype:'dashboard',htype:'mandate'}"
                [ngClass]="{'active':clicked2===true}">
                <input class=" d-none" name="options" type="radio" />

                <span class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
                  Yesterday
                </span>
                <span class=" d-block d-sm-none">
                  <i class=" tim-icons icon-tap-02"> </i>
                </span>
              </label>

              <label class=" btn btn-sm btn-danger btn-simple mx-1 m-0" [ngClass]="{'active':clicked3===true}">
                <div #nextActionDates class="cursor-pointer d-none">
                  <i class="fas fa-filter" style="color: white;"></i>&nbsp;
                </div>
                <span id="nextActionDates" class=" d-none d-sm-block d-md-block d-lg-block d-xl-block">
                  {{datecustomfetch}}
                </span>
                <span class=" d-block d-sm-none">
                  <i class=" tim-icons icon-tap-02"> </i>
                </span>
              </label>
            </span>
            <p>
              <button type="button" class="btn btn-warning buttonwithicon p-2 mb-0" (click)="refresh()"><i
                  class="fas fa-redo"></i>Reset</button>
            </p> -->
            <button type="button" class="btn btn-warning buttonwithicon p-2 mb-0" (click)="refresh()"
              style="border-radius: 50px !important;padding-block: 0.25rem !important;background-color: #ffffff !important;color: #00476A !important;border-color: #00476A !important;">
              Download Report <img src="../../../assets/images/file_download.png"></button>

            <button style="border-radius: 50px !important;padding-block: 0.25rem !important;" type="button"
              class="btn btn-warning buttonwithicon p-2 mb-0" (click)="refresh()">Add Inventory <i
                class="fa fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="col-12 row p-0 m-0">
          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="assigned_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Assigned</p>
                  <span class="count_font">{{assignedCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/double_home_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="available_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">available Units</p>
                  <span class="count_font">{{availableUnitsCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/key_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="booked_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Total Booked</p>
                  <span class="count_font">{{bookedCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/favourite_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="shared_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Cancelled Bookings</p>
                  <span class="count_font">{{cancelledCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/shared_icon.png">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 row p-0 m-0 pt-3">
          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="agreement_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Sale Agreement Due</p>
                  <span class="count_font">{{agreementCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/note_pencil_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="loan_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Loan Disbursement Due</p>
                  <span class="count_font">{{disbursementCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/home_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="registration_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Registration Due</p>
                  <span class="count_font">{{registrationCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/note_icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="col-3">
            <div class="card hoverclass border-style">
              <div class="sold_card d-flex justify-content-between align-items-center p-3 flex-row rounded">
                <div>
                  <p class="count_header mb-0 text-capitalize">Sold Units</p>
                  <span class="count_font">{{soldUnitsCount}}</span>
                </div>
                <div class="text-center pt-1">
                  <img src="../../../assets/images/sold_icon.png">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-12 col-md-12 mb-md-0 mb-4">
          <div class="card" style="margin-top: 0.5rem !important;border: none;">
            <div class="col-12 row m-0 align-items-center flex px-1 py-2">
              <div class="col-3 px-1">
                <i class="fa fa-search search_in"></i>
                <input class="form-control search_input" type="text" [(ngModel)]="units_name"
                  placeholder="Search Unit number"  autocomplete="off" (input)="filterUnits()"
                  style="border-radius: 30px;width: 100%;height: 32px;padding: .375rem 2.2rem .375rem 0.5rem;" />
              </div>

              <div class="col-2 px-1 d-flex align-items-center gap-2">
                <label class="m-0">Tower:</label>
                <select id="tower_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3 tower_drop"
                  (change)="towerchange($event)">
                  <!-- <option value="">Select Tower</option> -->
                  <option value="" selected>All</option>
                  <option *ngFor="let tower of towerList" value="{{tower.tower_IDPK}}" [selected]="tower.tower_IDPK == towerId">{{tower.tower_name}}</option>
                </select>
              </div>

              <div class="col-2 px-1 d-flex align-items-center gap-2">
                <label class="m-0">BHK:</label>
                <select id="bhk_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3 bhk_drop"
                  (change)="bhkchange($event)">
                  <!-- <option value="">Select BHK</option> -->
                  <option value="" selected>All</option>
                  <option *ngFor="let bhk of bhkList" value="{{bhk.bhk_IDFK}}" [selected]="bhk.bhk_IDFK == bhkSize">{{bhk.bhk}}</option>
                </select>
              </div>

              <div class="col-2 px-1 d-flex align-items-center gap-2">
                <label class="m-0">Size:</label>
                <select id="size_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3 size_drop"
                  (change)="sizechange($event)">
                  <!-- <option value="">Select Size</option> -->
                  <option value="" selected>All</option>
                  <option *ngFor="let size of sizeList" value="{{size.unit_size}}" [selected]="size.unit_size == unitsize">{{size.unit_size}}</option>
                </select>
              </div>

              <div class="col-2 px-1 d-flex align-items-center gap-2">
                <label class="m-0">Status:</label>
                <select id="status_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3 status_drop"
                  (change)="statuschange($event)">
                  <!-- <option value="">Select status</option> -->
                  <option value="" selected>All</option>
                  <option *ngFor="let sta of statusList" value="{{sta.unitstatus_IDFK}}" [selected]="sta.unitstatus_IDFK == status">{{sta.unitstatus}}</option>
                </select>
              </div>

              <div class="col-1 d-flex justify-content-center px-1">
                <button type="button" class="btn btn-warning btn_with_icon" (click)="refresh()"><i
                    class="fas fa-redo"></i>Reset</button>
              </div>

            </div>
            <div class="card-header"
              style="padding-inline:0rem !important;padding-block: 0.3rem !important;background: #F9FAFB !important;border: none;">
              <div class="col-12 p-0 d-flex justify-content-between align-items-center">
                <h6 class="hoverclass mb-0" style="font-size: 24px !important;font-weight: 400 !important;">
                  Detailed Units View
                </h6>
                <div class="button_section pr-0 pl-0 d-flex ">
                  <div class="planleadassign">
                    <a class="add_class table_section active" (click)="viewChange('table')">
                      <img src="../../../assets/images/table.png" *ngIf="isViewType == 'table'">
                      <img src="../../../assets/images/table_bg.png" *ngIf="isViewType == 'block'">
                      Table View
                    </a>

                    <a class="add_class block_section" (click)="viewChange('block')">
                      <img src="../../../assets/images/block_bg.png" *ngIf="isViewType == 'table'">
                      <img src="../../../assets/images/block.png" *ngIf="isViewType == 'block'">
                      Block View
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <div class="card-body px-0 pb-2" style="background: #F9FAFB !important;padding-inline:0rem !important"
              *ngIf="isViewType == 'table'">
              <div class="table-responsive" style="background:  #ffffff;height:100%">
                <table class="table align-items-center mb-0">
                  <thead style="border: none;">
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Unit No</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Floor</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Size</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">BHK</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Facing</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Status</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Updated By
                      </th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Updated On
                      </th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let detail of propertyDetails; let i = index">
                      <td>{{detail.unit_name}}</td>
                      <td>{{detail.floor_number}}</td>
                      <td>{{detail.unit_size?detail.unit_size:'---' }} <span *ngIf="detail.unit_size">sqft</span></td>
                      <td>{{detail.bhk}}</td>
                      <td>{{detail.doorfacing}}</td>
                      <td>
                        <span *ngIf="detail.unitstatus_IDFK == 2" style="color: #B14A41;">{{detail.unitstatus}}</span>
                        <span *ngIf="detail.unitstatus_IDFK == 1" style="color: #0C7300;">{{detail.unitstatus}}</span>
                        <span *ngIf="detail.unitstatus_IDFK != 1 && detail.unitstatus_IDFK != 2" style="color: #747474;">{{detail.unitstatus}}</span>
                      </td>
                      <td>{{detail.updated_by}}</td>
                      <td>{{detail.updated_at}}</td>
                      <td><button class="btn btn-secondary edit_btn" type="button" (click)="editUnit(detail)"><i
                            class="fa fa-pen"></i></button></td>
                    </tr>
                  </tbody>
                  <div class="font-weight-bold pt-3 d-flex justify-content-center" *ngIf="propertyDetails?.length == 0"
                    style="position: relative;top: 60px;left: 170px;border: none;">
                    NO DATA FOUND ...!
                  </div>
                </table>
              </div>
            </div>

            <div class="card-body px-0 pb-2 " style="background: #F9FAFB ;padding-inline:0rem !important;padding-block: 0rem !important;"
              *ngIf="isViewType == 'block'">
              <div class="col-12 row d-flex align-items-center justify-content-between sticky_header">
                <div class="button_section pr-0 pl-0 d-flex gap-2">
                  <div class="block_tower_section" *ngFor="let det of propertyDetails">
                    <a class="add_class" [ngClass]="{'active' : det.towerid == selectedTower?.towerid}"
                      (click)="blockTower(det)">
                      {{det.towername}}
                    </a>
                  </div>
                </div>

                <div>
                  <span class="sold_text">Sold <i class="fas fa-circle" style="font-size: 12px;"></i></span>
                  <span class="available_text">Available <i class="fas fa-circle" style="font-size: 12px;"></i></span>
                </div>
              </div>
              <div class="col-12" style="background: #ffffff;">
                <div class="col-12 p-0" *ngFor="let data of selectedTower?.floors">
                  <h4 class="my-1">{{data.floorid}} Floor : {{data.floor_units}} Units</h4>
                  <div class="col-12 row m-0 p-3"
                    style="background: #F9FAFB;gap: 1rem;border: 1px solid #BCBCBC;border-radius: 6px;">
                    <div class="unit_box text-center col-1 py-2 px-2" *ngFor="let unit of data.units"
                      [ngStyle]="{'background' : unit.unitstatus_IDFK == '1' ? '#D1FFC9' : '#FFF1EF' , 'border-color' : unit.unitstatus_IDFK == '1' ? '#006900' : '#B14A41' , 'color' : unit.unitstatus_IDFK == '1' ? '#006900' : '#B14A41'}">
                      <span class="facing_styles"
                        [ngStyle]="{'background' : unit.unitstatus_IDFK == '1' ? '#D1FFC9' : '#FFF1EF'}">{{unit.doorfacing.slice(0,
                        1)}}</span>
                      <div class="font_20">{{unit.unit_name}}</div>
                      <div class="font_18">{{unit.bhk}}</div>
                      <div class="font_18">{{unit.unit_sbs }} <span style="font-weight: 300 !important;">Sqft</span>
                      </div>
                      <div class="hover-icons" (click)="editUnit(data)">
                        <i class="fa fa-pen iconcolor1"></i>
                      </div>
                    </div>
                  </div>
                  <hr class="my-4" style="width: 80%;color: #BCBCBC;">
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- on clicking on the notification icon the right side bar will be opened  -->
  <div [class.open]="isDrawerOpen" class="right-drawer">
    <!-- <div class="drawerClose"><i class="fa fa-times" (click)="closeDrawer()"></i></div> -->
    <div class="drawer-content relative">
      <div class="content_mess">
        <div class="update_status">
            Update Unit Status
        </div>

        <div class="col-12">

          <div class="col-12 p-0 py-3" *ngIf="selectedEditUnit?.unitstatus_IDFK != 1">
            <div class="col-12 row m-0 p-2 lead_details">
              <div class="col-4 px-1">
                <span class="label_header">Last Updated by</span>
                <div class="edit_data_color">Jagan</div>
              </div>

              <div class="col-5 px-1">
                <span class="label_header">Last Updated on</span>
                <div class="edit_data_color">09:45AM,07-Aug-2025</div>
              </div>

              <div class="col-3 px-1">
                <span class="label_header">Last Status</span>
                <div class="edit_data_color">Sold</div>
              </div>

              <div class="col-12 px-1">
                <span class="label_header">Remarks</span>
                <div class="edit_data_color">Blocked by Mr.Kamesh, Token received.</div>
              </div>

              <div class="col-12 px-1 pt-2">
                <div class="label_header">This unit is currently Sold by: <span class="edit_data_color">Jagan</span></div>
              </div>
            </div>
          </div>

          <div class="col-12 p-0 py-3">
              <label class="label_edit_headers">BHK Type</label>
              <div class="wrapper" >
                <span *ngFor="let bhk of allListBhk">
                  <button class="btn btn-danger" [ngClass]="{'btn_danger_active': selectedEditBhkId == bhk.bhk_IDPK}" 
                  type="button" (click)="selectedEditBhk(bhk.bhk_IDFK)">{{bhk.bhk_numbers}}</button>
                </span>
              </div>
          </div>

          <div class="col-12 p-0 py-3">
              <label class="label_edit_headers">Unit Number</label>
                <select id="unit_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3"
                (change)="unitchange($event)">
                <option value="">Select Unit</option>
                <option *ngFor="let unit of unitList" value="{{unit.property_idfk}}"
                  [selected]="unit.property_idfk == propertyid">{{unit.property_info_name}}</option>
              </select>
          </div>

          <div class="col-12 p-0 py-3 d-flex gap-3" *ngIf="selectedEditUnit?.unitstatus_IDFK == 1">
                <label class="label_edit_headers">Mark Unit A1203 as Sold </label>
                <input type="checkbox" (click)="onCheckboxAsSold($event)" style="width: 20px;height: 20px;">
          </div>

          <div class="col-12 p-0 py-3" *ngIf="selectedEditUnit?.unitstatus_IDFK != 1">
            <label class="label_edit_headers">Unit Status</label>
              <div class="wrapper" >
                  <button class="btn btn-danger" [ngClass]="{'btn_danger_active': 'booking' == selectedUnitStatus}" 
                  type="button" (click)="selectUnitStatusData('booking')">Cancel this Booking</button>

                   <button class="btn btn-danger" [ngClass]="{'btn_danger_active': 'resale' == selectedUnitStatus}" 
                  type="button" (click)="selectUnitStatusData('resale')">Mark for Resale</button>
              </div>

              <div class="col-12 px-0 py-3">
                <div class="unit_status_bg" *ngIf="selectedUnitStatus == 'booking'">
                  <span style="line-height: 2rem;">
                    Once Cancelled, A101 unit will be <br>
                    moved back to <span style="color: #005B00;">'Available'</span>
                  </span>
                </div>

                <div class="unit_status_bg px-2" *ngIf="selectedUnitStatus == 'resale'">
                  <span style="line-height: 2rem;">A101 unit will be moved to Resale Inventory.</span>
                </div>
              </div>
          </div>

          <div [ngClass]="{'blurred' : isCheck == false}" *ngIf="selectedEditUnit?.unitstatus_IDFK == 1">
            <div class="col-12 p-0 py-3">
              <label class="label_edit_headers">Select Executive</label>
                <select id="exec_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3"
                (change)="rmchange($event)">
                <option value="">Select Executive Name</option>
                <option *ngFor="let exec of executiveList" value="{{exec.id}}">{{exec.name}}</option>
              </select>
            </div>

            <div class="col-12 p-0 py-3">
              <label class="label_edit_headers">Select Lead</label>
                <select id="lead_dropdown" class="form-control ui dropdown dashboard_dropdown mr-3"
                (change)="leadchange($event)">
                <option value="">Select Lead Name</option>
                <option *ngFor="let lead of leadsList" value="{{lead.property_idfk}}"
                  [selected]="lead.property_idfk == propertyid">{{lead.property_info_name}}</option>
              </select>
            </div>

             <div class="col-12 p-0 py-3">
              <label class="label_edit_headers">Remarks</label>
              <textarea class="form-control addleadtextarea" id="address" placeholder="Write your remarks here." [(ngModel)]="editremarks" #address="ngModel"
                name="address"></textarea>
            </div>
          </div>
        </div>

        <div class="update_status_buttons col-12">
           <button class="btn btn-primary" type="button" (click)="closeDrawer()">Cancel</button>
           <button class="btn btn-warning" type="button" style="font-size: 18px !important;" *ngIf="selectedEditUnit?.unitstatus_IDFK != 1">Update Unit</button>
           <button class="btn btn-info" type="button" style="font-size: 18px !important;" *ngIf="selectedEditUnit?.unitstatus_IDFK == 1">Sold</button>
        </div>

      </div>
    </div>
  </div>
  <!-- Optional: Overlay background that appears when the drawer is open -->
  <div class="overlay" *ngIf="isDrawerOpen" (click)="toggleDrawer()"></div>

  <div *ngIf=filterLoader class="main-lds-ring-div">
    <!-- <div class="lds-ring">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div> -->
     <img src="../../../assets/images/infinity_loader.gif">
  </div>

</body>