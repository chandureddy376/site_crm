<div>
  <app-header></app-header>
</div>

<div class="row main_count_header" [ngStyle]="{'padding-left':isSidebarHovered ? '15.5rem' : '4.8rem'}">
  <div class="col-12 p-0 row m-0">
    <div class="col-4 p-1 main-chat-list-container" [hidden]="isCreationGroup || isGroupName">
      <div class="col 12 p-0 d-flex justify-content-center align-items-center"
        style="padding-right: 0.5rem !important;">

        <div class="col-11 pl-0 d-flex justify-content-between align-items-center">
          <i class="fa fa-search search_in" style="color: #0B7AB2;"></i>
          <input class="form-control search_input" type="text" [(ngModel)]="executive_name" placeholder="Search"
            (ngModelChange)="searchSubject.next($event)" autocomplete="off"
            style="border-radius: 30px;width: 100%;height: 2.71428571em;padding: .375rem 2rem;" />
          <span class="search_close_icon" (click)="clearSearchedResult()" *ngIf="executive_name?.length > 0"><i
              class="fa fa-times"></i></span>
        </div>
        <div class="col-1 p-0 text-center more_options">
          <span class="list_more_options cursor-pointer">
            <div class="dropleft">
              <a class="" id="more_btn1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-ellipsis-v" style="font-size: 15px;"></i>
              </a>
              <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                <a class="dropdown-item dropDownCursor" (click)="getSelectedGroupMem()">New Group</a>
              </div>
            </div>
          </span>
        </div>
      </div>
      <!-- select chat type  -->
      <div class="button_section col-12 p-0 py-1">
        <div class="chats_cat_types d-flex justify-content-between" style="gap: 0.25rem !important;">
          <a class="add_class all_chat active" routerLink="/team-chat" [queryParams]="{allchat:1}">All</a>
          <a class="add_class groups_chat" routerLink="/team-chat" [queryParams]="{groupchat:1}">Groups</a>
          <a class="add_class unread_chat" routerLink="/team-chat" [queryParams]="{unreadchat:1}">Unread</a>
          <a class="add_class options_chat blurred" routerLink="/team-chat" [queryParams]="{optionchat:1}">Options</a>
        </div>
      </div>
      <!-- list of messages  -->
      <div class="chat-list-container" style="overflow: scroll;cursor: pointer;"
        *ngIf="executivesList?.length > 0 && ((executive_name?.length == 0 || executive_name == '' || executive_name == undefined || executive_name == null) && (searchedChatsResultsArray && searchedMessagesResultsArray))">
        <div class="col-12 p-0 chat_list d-flex" *ngFor="let exec of executivesList; let index = index"
          [ngClass]="{'selected': (exec.executives_IDPK == chatid && exec.chat_type == 'individual') || (exec.chat_id == chatid && exec.chat_type == 'group')}"
          (click)="selectedchat(exec,index)">
          <div class="col-2 px-1 text-center relative">
            <span class="icon_user">
              <i class="fa fa-users" style="font-size: 15px;" *ngIf="exec.chat_type == 'group'"></i>
              <i class="fa fa-user" style="font-size: 15px;" *ngIf="exec.chat_type == 'individual'"></i>
            </span>
            <span class="disappear_hrs" *ngIf="exec.encryptid == 1"><img
                src="../../../assets/images/24-hour-disappear-icon.png"></span>
          </div>
          <div class="col-10 p-0">
            <div class="col-12 px-2 d-flex justify-content-between">
              <!-- {{exec.executives_name | highlightText}} -->
              <h5 class="m-0 show_text_mes highlightMark"
                [innerHTML]="exec.executives_name | highlightText:executive_name">
              </h5>
              <span class="text-color-gr d-flex gap">
                <span class="online_text d-flex" *ngIf="exec.online_status == 'online'"> <span
                    style="font-size: xxx-large;">&bull;</span> Online</span>
                <span class="offline_text d-flex" *ngIf="exec.online_status == 'offline'"> <span
                    style="font-size: xxx-large;">&bull;</span> Offline</span>

                <span class="unread_messages" *ngIf="exec.unreadcount > 0"
                  [ngStyle]="{'width' : exec.unreadcount > '99' ? 'auto' : '20px'}">{{exec.unreadcount}}</span>
              </span>
            </div>
            <div class="col-12 p-0 px-2 d-flex justify-content-between">

              <span class="text-color-gr show_text_mes col-9 p-0 highlightMark">
                <span>
                  <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '2' || exec.unreadcount == 0">
                  <img src="../../../assets/images/unread_icon.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '1' && exec.unreadcount != 0">
                </span>
                <span [innerHTML]="(exec.latest_message_content || '') | highlightText:executive_name"></span>
                <span>

                </span>
                <!-- {{(exec.latest_message_content?exec.latest_message_content:'') | highlightText}} -->
              </span>
              <span class="text-color-gr col-3 p-0"
                style="text-align: end;">{{getFormattedTime(exec.latest_message_time)}}</span>
            </div>
          </div>
        </div>

        <div *ngIf=searchfilterLoader class="loader-inside-container">
          <!-- <div class="lds-ring">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div> -->
          <img src="../../../assets/images/infinity_loader.gif">
        </div>
      </div>

      <div class="chat-list-container" style="overflow: scroll;cursor: pointer;"
        *ngIf="(searchedChatsResultsArray?.length > 0  || searchedMessagesResultsArray?.length > 0 ) && executive_name?.length > 0">
        <div class="col-12 search_result_test" *ngIf="searchedChatsResultsArray?.length > 0 ">Chats</div>
        <div class="col-12 p-0 chat_list d-flex" *ngFor="let exec of searchedChatsResultsArray; let index = index"
          [ngClass]="{'selected': (exec.executives_IDPK == chatid && exec.chat_type == 'individual') || (exec.chat_id == chatid && exec.chat_type == 'group')}"
          (click)="selectedchat(exec,index)">
          <div class="col-2 px-1 text-center relative">
            <!-- <span class="icon_user">
              <i class="fa fa-users" style="font-size: 15px;"></i>
            </span> -->
            <span class="icon_user">
              <i class="fa fa-users" style="font-size: 15px;" *ngIf="exec.chat_type == 'group'"></i>
              <i class="fa fa-user" style="font-size: 15px;" *ngIf="exec.chat_type == 'individual'"></i>
            </span>
            <span class="disappear_hrs" *ngIf="exec.encryptid == 1"><img
                src="../../../assets/images/24-hour-disappear-icon.png"></span>
          </div>
          <div class="col-10 p-0">
            <div class="col-12 px-2 d-flex justify-content-between">
              <h5 class="m-0 show_text_mes highlightMark"
                [innerHTML]="exec.executives_name | highlightText:executive_name">
              </h5>
              <span class="text-color-gr d-flex gap">
                <span class="online_text d-flex" *ngIf="exec.online_status == 'online'"> <span
                    style="font-size: xxx-large;">&bull;</span> Online</span>
                <span class="offline_text d-flex" *ngIf="exec.online_status == 'offline'"> <span
                    style="font-size: xxx-large;">&bull;</span> Offline</span>

                <span class="unread_messages" *ngIf="exec.unreadcount > 0"
                  [ngStyle]="{'width' : exec.unreadcount > '99' ? 'auto' : '20px'}">{{exec.unreadcount}}</span>
              </span>
            </div>
            <div class="col-12 p-0 px-2 d-flex justify-content-between">
              <span class="text-color-gr show_text_mes col-9 p-0 highlightMark">
                <span>
                  <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '2' || exec.unreadcount == 0">
                  <img src="../../../assets/images/unread_icon.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '1' && exec.unreadcount != 0">
                </span>
                <span [innerHTML]="(exec.latest_message_content || '') | highlightText:executive_name"></span>
              </span>
              <span class="text-color-gr col-3 p-0"
                style="text-align: end;">{{getFormattedTime(exec.latest_message_time)}}</span>
            </div>
          </div>
        </div>
        <div class="col-12 search_result_test" *ngIf="searchedMessagesResultsArray?.length > 0 ">Messages</div>
        <div class="col-12 p-0 chat_list d-flex" *ngFor="let exec of searchedMessagesResultsArray; let index = index"
          [ngClass]="{'selected': (exec.executives_IDPK == chatid && exec.chat_type == 'individual') || (exec.chat_id == chatid && exec.chat_type == 'group')}"
          (click)="selectedchat(exec,index)">
          <div class="col-2 px-1 text-center">
            <!-- <span class="icon_user">
                        <i class="fa fa-users" style="font-size: 15px;"></i>
                      </span> -->
            <span class="">
              <i class="fa fa-comment" style="font-size: 18px;color: #0B7AB2;"></i>
              <!-- <i class="fa fa-users" style="font-size: 15px;" *ngIf="exec.chat_type == 'group'"></i> -->
              <!-- <i class="fa fa-user" style="font-size: 15px;" *ngIf="exec.chat_type == 'individual'"></i> -->
            </span>
            <span class="disappear_hrs" *ngIf="exec.encryptid == 1"><img
                src="../../../assets/images/24-hour-disappear-icon.png"></span>
          </div>
          <div class="col-10 p-0">
            <div class="col-12 px-2 d-flex justify-content-between">
              <h5 class="m-0 show_text_mes highlightMark"
                [innerHTML]="exec.executives_name | highlightText:executive_name">
              </h5>
              <span class="text-color-gr d-flex gap">
                <span class="online_text d-flex" *ngIf="exec.online_status == 'online'"> <span
                    style="font-size: xxx-large;">&bull;</span> Online</span>
                <span class="offline_text d-flex" *ngIf="exec.online_status == 'offline'"> <span
                    style="font-size: xxx-large;">&bull;</span> Offline</span>

                <span class="unread_messages" *ngIf="exec.unreadcount > 0"
                  [ngStyle]="{'width' : exec.unreadcount > '99' ? 'auto' : '20px'}">{{exec.unreadcount}}</span>
              </span>
            </div>
            <div class="col-12 p-0 px-2 d-flex justify-content-between">
              <span class="text-color-gr show_text_mes col-9 p-0 highlightMark"
                [innerHTML]="(exec.latest_message_content || '') | highlightText:executive_name">
                <span>
                  <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '2'">
                  <img src="../../../assets/images/unread_icon.png" alt="" width="18px"
                    *ngIf="exec.has_messaged == '1'">
                </span>
                <span [innerHTML]="(exec.latest_message_content || '') | highlightText:executive_name"></span>
              </span>
              <span class="text-color-gr col-3 p-0"
                style="text-align: end;">{{getFormattedTime(exec.latest_message_time)}}</span>
            </div>
          </div>
        </div>

        <div *ngIf=searchfilterLoader class="loader-inside-container">
          <!-- <div class="lds-ring">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div> -->
          <img src="../../../assets/images/infinity_loader.gif">
        </div>

      </div>


      <div class="chat-list-container d-flex justify-content-center align-items-center"
        style="overflow: scroll;cursor: pointer;"
        *ngIf="executivesList?.length == 0 || (executive_name?.length > 0 && searchedChatsResultsArray?.length == 0 && searchedMessagesResultsArray?.length == 0)">
        <span style="font-size: 22px;font-weight: bold;font-style: italic;color: #0B7AB2;">No Members Found</span>
      </div>
    </div>

    <!-- group creation html code  -->
    <div class="col-4 p-0 chat-list-container" [hidden]="!isCreationGroup" style="height: calc(100vh - 60px)">
      <div class="col 12 p-0 chat_list">
        <div style="cursor: pointer;height: calc(100vh - 60px);overflow: scroll;">
          <div class="d-flex px-3 d-flex justify-content-between group_header">
            <span class="d-flex  align-items-center gap">
              <button type="button" class="close" (click)="closeGroupModal()">&times;</button>
              <h4 class="m-0">Add Group Members</h4>
            </span>
            <span>
              <button class="btn btn-warning" type="button" *ngIf="selectedGroupExecutives?.length >= 2"
                style="padding: .1rem .5rem !important;" (click)="createGroupName()"><i
                  class="fa fa-arrow-right"></i></button>
            </span>
          </div>
          <div class="col-12 d-flex justify-content-between align-items-center"
            style="position: sticky;top: 22px;z-index: 1;background: #ffffff;">
            <input class="form-control search_input" type="text" [(ngModel)]="executive_name" placeholder="Search"
              (keyup)="searchGroupCreationExecutive()" autocomplete="off"
              style="border-radius: 3px;width: 100%;height: 2.71428571em;padding: .375rem 2rem;" />
          </div>
          <div id="filtermaindiv" class="filterspan my-2 mx-1">
            <span *ngFor="let exec of selectedGroupExecutives;let i = index">
              <div class="p-1 chip">
                {{exec.executives_name}}
                <span class="closebtn" (click)="executiveclose(i,exec)">&times;</span>
              </div>
            </span>
          </div>
          <div class="col-12 p-0 chat_list d-flex" *ngFor="let exec of executivesList; let i = index">
            <div class="col-2 px-1 text-center">
              <span class="icon_user">
                <i class="fa fa-users" style="font-size: 15px;"></i>
              </span>
            </div>
            <div class="col-10 p-0">
              <div class="col-12 px-2 d-flex gap" id="start3">
                <span class="">
                  <input type="checkbox" class="mr-4 loopcheckbox creategrouphidecheckbox" id="creategroupcheckboxid"
                    value="{{ exec }}" name='programming' [checked]="isSelected(exec)" (change)="getselectedMembers()"
                    [attr.data-assign]="exec | json">
                </span>
                <h5 class="m-0 show_text_mes">{{exec.executives_name}}</h5>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-center align-items-center" style="overflow: scroll;cursor: pointer;"
            *ngIf="executivesList?.length == 0 || (executive_name?.length > 0 && searchedChatsResultsArray?.length == 0 && searchedMessagesResultsArray?.length == 0)">
            <span style="font-size: 22px;font-weight: bold;font-style: italic;color: #0B7AB2;">No Members Found</span>
          </div>
        </div>
      </div>
    </div>
    <!-- group creation html code  -->

    <!-- group name and photo html code  -->
    <div class="col-4 p-0 chat-list-container" [hidden]="!isGroupName" style="height: calc(100vh - 60px)">
      <div class="col 12 p-0">
        <div style="overflow: scroll;cursor: pointer;">
          <div class="d-flex px-3 d-flex justify-content-between group_header">
            <span class="d-flex  align-items-center gap">
              <button type="button" class="close" (click)="closeGroupNameModal()">&times;</button>
              <h4 class="m-0">New Group</h4>
            </span>
          </div>

          <div class="d-flex justify-content-center pt-3">
            <div class="upload_pic" (click)="addProfilePhoto()">
              <i class="fa fa-users" style="font-size: 6rem;color:#878989"></i>
              <span style="position: absolute;text-align: center;color: white;"><i class="fa fa-camera"></i><br>Add
                Group Icon</span>
            </div>
            <input title="Upload file smaller than 10MB" placeholder="Upload file smaller than 10MB" type="file"
              data-max-size="10000000" (change)="uploadProfilePic('0',$event)" class="custom-file-input"
              id="customFile{{'0'}}" name="filename" style="display: none;">
            <!-- <label class="custom-file-label file-label" for="customFile{{'0'}}">Choose file</label> -->
          </div>

          <div class="pt-3 px-2">
            <input type="text" class="form-control group_name" name="name" id="name" placeholder="Enter the Group Name"
              autocomplete="off" [(ngModel)]="groupName" #name="ngModel" required>
          </div>

          <div class="d-flex justify-content-center pt-3">
            <button class="btn btn-warning" type="button" style="padding: .1rem .5rem !important;"
              (click)="createGroup()">Create Group</button>
          </div>
        </div>
      </div>
    </div>
    <!-- group name and photo creation html code  -->

    <!-- message details of a particular person or group  -->
    <div class="p-0 single-chat-container" [ngClass]="isSearch == true  ? 'col-5' : 'col-8'" *ngIf="selectedPersonChat">
      <!-- view group name and search along with more  -->
      <div class="col-12 p-0 chat_list d-flex">
        <div class="col-1 p-0 text-center relative">
          <span class="icon_user" (click)="groupChatInfo()">
            <i class="fa fa-users" style="font-size: 15px;" *ngIf="selectedPersonChat?.chat_type == 'group'"></i>
            <i class="fa fa-user" style="font-size: 15px;" *ngIf="selectedPersonChat?.chat_type == 'individual'"></i>
          </span>
          <span class="disappear_hrs" *ngIf="selectedPersonChat?.encryptid == 1"><img
              src="../../../assets/images/24-hour-disappear-icon.png">
          </span>
        </div>
        <div class="col-9 p-0" (click)="groupChatInfo()">
          <div class="col-12 p-0 d-flex justify-content-between show_text_mes cursor-pointer">
            <h5 class="m-0">{{selectedPersonChat.executives_name}}</h5>
          </div>
          <div class="col-12 p-0 show_text_mes">
            <!-- (click)="groupChatInfo()"  removed for individual chat , if need we can add-->
            <span class="text-color-gr cursor-pointer" *ngIf="chattype == 'individual'">click here for contact
              info</span>
            <span class="text-color-gr cursor-pointer show_text_mes"
              *ngIf="chattype == 'group'">{{listOfMembersNames}}</span>
          </div>
        </div>
        <div class="col-2 p-0 d-flex align-items-center" style="justify-content: space-evenly;">
          <span class="icon_user" (click)="searchMessage()">
            <i class="fa fa-search" style="font-size: 15px;"></i>
          </span>
          <span class="icon_user">
            <div>
              <a class="dropleft" id="more_btn2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-ellipsis-v" style="font-size: 15px;"></i>
              </a>
              <div class="dropdown-menu chatMoreFilter" aria-labelledby="more_btn2"
                style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                <a class="dropdown-item dropDownCursor"
                  *ngIf="chattype == 'group' && selectedPersonChat?.encryptid == 0 && (roleid == 1 || roleid == 2)"
                  (click)="disappear24('1')">Enable 24Hrs Disappear</a>
                <a class="dropdown-item dropDownCursor"
                  *ngIf="chattype == 'group' && selectedPersonChat?.encryptid == 1 && (roleid == 1 || roleid == 2)"
                  (click)="disappear24('0')">Disable 24Hrs Disappear</a>
                <a class="dropdown-item dropDownCursor" (click)="closechat()">Close Chat</a>
              </div>
            </div>
          </span>
        </div>
      </div>

      <!-- body of the send message section  -->
      <div #messageContainer class="col-12 p-0 text_process pt-1" (scroll)="onScroll()" infinite-scroll
        [fromRoot]="true" [scrollWindow]="false" [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50"
        [infiniteScrollContainer]="'.text_process'"
        [ngClass]="{'text_process_normal': textareaRows <= 3,'text_process_increase': textareaRows > 3}">
        <div class="sticky-date-header" *ngIf="floatingDate && shouldShowArrow">
          <span class="float_date">{{ floatingDate }}</span>
        </div>

        <div class="sticky-date-header" *ngIf="loadmoreChat && messageList.length > 0" style="top: 25px !important;">
          <span class="float_date cursor-pointer" (click)="fetchOlderMessages()"><i class="fa fa-sync pr-1"></i> Click
            here to Load More</span>
        </div>
        <div class="sticky-date-header" style="top: 10px !important;font-style: italic;"
          *ngIf="roleid != 1 && roleid != 2 && chattype == 'group' && selectedPersonChat?.encryptid == 1">
          <span class="disappear_date cursor-pointer"> <i class="fas fa-clock" style="color:#557482 ;"></i>24 hours
            disappearing Enabled</span>
        </div>
        <div class="sticky-date-header" *ngIf="isLoadmoreIcon" style="top: 35px !important;">
          <span class="float_loadmore cursor-pointer" (click)="fetchOlderMessages()"><i
              class="fas fa-spinner pr-1 spinning-icon" style="font-size: 18px;"></i>Loading the chat</span>
        </div>
        <div *ngFor="let message of messageList">

          <div class="col-12 p-0 row m-0 py-1" *ngIf="message.sender_id != userid && message.item_type == 'message'"
            [attr.id]="'chat-item-' + message.item_id" (dblclick)="onMessageDoubleClick(message)">

            <div class="col-1 p-0 text-center pt-0 d-flex align-items-center"
              [ngStyle]="{'justify-content' : selectedMessageOption == 'forward' ? 'space-around' : 'center'}">
              <div *ngIf="selectedMessageOption == 'forward'" class="pr-2">
                <input type="checkbox" [checked]="selectedMessages.includes(message)"
                  (click)="onMessageSelect($event,message)">
              </div>
              <span class="icon_user">
                <i class="fa fa-user" style="font-size: 12px;"></i>
              </span>
            </div>
            <div class="col-11 p-0" [ngClass]="isSearch == true  ? 'col-6' : 'col-11'">
              <span *ngIf="message.deleted == '1' && message.sender_id != userid" class="delete_message">This message
                was deleted.</span>
              <div class="message-bubble " *ngIf="message.deleted != '1'" style="border-top-left-radius: 0;">
                <span class="arrow"><i class="fa fa-play" style="transform: rotate(60deg);color: #ffffff;"></i></span>
                <div class="dropright message_options_icon" *ngIf="chattype != 'group'">
                  <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false" (click)="externalOptionMes(message)">
                    <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                  </a>
                  <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                    style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                    <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('reply',message)"><i
                        class="fa fa-reply"></i> Reply</a>
                    <a class="dropdown-item dropDownCursor message-options"
                      (click)="messageOptions('forward',message)"><i class="fa fa-share"></i> Forward</a>
                    <a class="dropdown-item dropDownCursor message-options"
                      (click)="messageOptions('replywithmessage',message)"><i class="fa fa-reply"></i> Reply with
                      Message</a>
                    <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('edit',message)"><i
                      class="fa fa-pencil-alt"></i> Edit</a> -->
                    <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('delete',message)"><i
                      class="fa fa-trash"></i> Delete</a> -->
                  </div>
                </div>
                <div class="forwarded_text" *ngIf="chattype != 'group' && message.forwarded == '1'"><i
                    class="fa fa-share"></i>Forwarded</div>
                <div class="message-content">
                  <div class="sender-name" *ngIf="chattype == 'group'" style="gap: 0.5rem;">
                    <span>{{message.sender_name}}</span>
                    <!-- <span><i class="fa fa-chevron-down" style="font-size: 14px !important;"></i></span> -->
                    <div class="dropleft message_options_icon">
                      <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false" (click)="externalOptionMes(message)">
                        <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                      </a>
                      <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                        style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('reply',message)"><i class="fa fa-reply"></i> Reply</a>
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('forward',message)"><i class="fa fa-share"></i> Forward</a>
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('replywithmessage',message)"><i class="fa fa-reply"></i> Reply with
                          Message</a>
                        <!-- <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('edit',message)"><i class="fa fa-pencil-alt"></i> Edit</a> -->
                        <!-- <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('delete',message)"><i class="fa fa-trash"></i> Delete</a> -->
                      </div>
                    </div>
                  </div>
                  <div class="forwarded_text" *ngIf="chattype == 'group' && message.forwarded == '1'"><i
                      class="fa fa-share"></i>Forwarded</div>
                  <div class="message-text-container">
                    <div class="replied_message" *ngIf="message.replied_message && message.replied_to_whom"
                      (click)="searchedMessageClicked(message,'rep')">
                      <!-- <span style="color: #2196F3;font-weight: 600;">{{message.replied_to_whom}}</span> -->
                      <span *ngIf="message?.replied_to_whomid != userid"
                        style="color: #2196F3;font-weight: 600;">{{message?.replied_to_whom}}</span>
                      <span *ngIf="message?.replied_to_whomid == userid"
                        style="color: #2196F3;font-weight: 600;">You</span>
                      <div class="show_text_mes">{{message.replied_message}}</div>
                    </div>
                    <!-- <div [innerText]="message.content"></div> -->
                    <!-- <pre class="m-0" [innerHTML]="formatMessage(message.content)" (copy)="onCopy($event, message.content)"></pre> -->
                    <!-- <div class="m-0 message-content" #messageDiv [innerHTML]="formatMessage(message.content)"
                      (copy)="onCopy($event, message.content)"></div> -->
                    <div class="message-text" [title]="message.content" (copy)="onCopy($event, message.content)">
                      <ng-container *ngFor="let part of message.content | highlightNumbers">
                        <!-- Render line breaks -->
                        <ng-container *ngIf="part.isLineBreak; else textPart">
                          <br />
                        </ng-container>

                        <!-- Render regular or phone text -->
                        <ng-template #textPart>
                          <span *ngIf="part.isPhoneNumber" class="mobile-number"
                            (click)="numberClicked(part.text, $event)">
                            {{ part.text }}
                          </span>
                          <span *ngIf="!part.isPhoneNumber && !part.isBold && !part.isItalic && !part.isLink">
                            {{ part.text }}
                          </span>
                          <strong *ngIf="!part.isPhoneNumber && part.isBold">
                            {{ part.text }}
                          </strong>
                          <em *ngIf="!part.isPhoneNumber && part.isItalic">
                            {{ part.text }}
                          </em>
                          <a *ngIf="!part.isPhoneNumber && part.isLink" [href]="part.text" target="_blank"
                            rel="noopener noreferrer" class="hyperlink">
                            {{ part.text }}
                          </a>
                        </ng-template>
                        <!-- <span *ngIf="part.isPhoneNumber" class="mobile-number"
                          (click)="numberClicked(part.text,$event)">{{ part.text }}</span>
                        <span *ngIf="!part.isPhoneNumber">{{ part.text }}</span> -->
                      </ng-container>
                    </div>
                    <div class="timestamp">
                      <span *ngIf="message.edited == '1'" class="edited_text px-1">Edited</span>
                      <span *ngIf="message.edited == '1'">{{(message.updated_at?message.updated_at:'') | date: 'hh:mm
                        a'}}</span>
                      <span *ngIf="message.edited == '0'">{{(message.created_at?message.created_at:'') | date: 'hh:mm
                        a'}}</span>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="col-12 p-0 row m-0 py-1" *ngIf="message.sender_id != userid && message.item_type == 'attachment'">
            <div class="col-1 p-0 text-center pt-1">
              <span class="icon_user">
                <i class="fa fa-user" style="font-size: 12px;"></i>
              </span>
            </div>
            <div class="col-11 p-0" [ngClass]="isSearch == true  ? 'col-6' : 'col-11'">
              <span *ngIf="message.deleted == '1' && message.sender_id != userid" class="delete_message">This message
                was deleted.</span>
              <div class="message-bubble p-0" *ngIf="message.deleted != '1'" style="border-top-left-radius: 0;">
                <span class="arrow"><i class="fa fa-play" style="transform: rotate(60deg);color: #ffffff;"></i></span>
                <div class="dropleft message_options_icon" *ngIf="chattype != 'group'">
                  <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false" (click)="externalOptionMes(message)">
                    <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                  </a>
                  <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                    style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                    <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('reply',message)"><i
                        class="fa fa-reply"></i> Reply</a>
                    <!-- <a class="dropdown-item dropDownCursor message-options"
                      (click)="messageOptions('forward',message)"><i class="fa fa-share"></i> Forward</a> -->
                    <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('edit',message)"><i
                      class="fa fa-pencil-alt"></i> Edit</a> -->
                    <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('delete',message)"><i
                      class="fa fa-trash"></i> Delete</a> -->
                  </div>
                </div>
                <div class="forwarded_text" *ngIf="chattype != 'group' && message.forwarded == '1'"><i
                    class="fa fa-share"></i>Forwarded</div>
                <div class="message-content">
                  <div class="sender-name px-2" *ngIf="chattype == 'group'">
                    <span>{{message.sender_name}}</span>
                    <div class="dropleft message_options_icon">
                      <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false" (click)="externalOptionMes(message)">
                        <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                      </a>
                      <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                        style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('reply',message)"><i class="fa fa-reply"></i> Reply</a>
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('forward',message)"><i class="fa fa-share"></i> Forward</a>
                        <!-- <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('edit',message)"><i class="fa fa-pencil-alt"></i> Edit</a>
                        <a class="dropdown-item dropDownCursor message-options"
                          (click)="messageOptions('delete',message)"><i class="fa fa-trash"></i> Delete</a> -->
                      </div>
                    </div>
                  </div>
                  <div class="forwarded_text" *ngIf="chattype == 'group' && message.forwarded == '1'"><i
                      class="fa fa-share"></i>Forwarded</div>
                  <div class="message-text">
                    <div class="col-12 p-0">
                      <div class="">
                        <div class="image-container d-flex justify-content-center" style="padding: 5px;">
                          <ng-container *ngIf="message?.attachment_name?.endsWith('.pdf'); else checkImageOrVideo">
                            <div class="d-flex" style="justify-content: space-evenly;gap: 0.5rem;">
                              <div class="d-flex align-items-center"><i class="far fa-file-pdf"
                                  style="color: #ff0000;font-size: xx-large;"></i></div>
                              <div class="">
                                <span style="font-size: 12px;">{{message.attachment_name}}</span>

                                <div style="font-size: 12px;">
                                  <span>. PDF</span>
                                </div>

                              </div>
                              <div class="d-flex align-items-end cursor-pointer">
                                <i class="fa fa-download" (click)="downloadPDF(message)"></i>
                              </div>
                            </div>
                          </ng-container>

                          <ng-template #checkImageOrVideo>
                            <ng-container *ngIf="isVideo(message.attachment_name); else showImage">
                              <video width="200" height="100%" controls>
                                <source [src]="getImagesFilesUrl(message)" type="video/mp4">
                                Your browser does not support the video tag.
                              </video>
                            </ng-container>

                            <ng-template #showImage>
                              <!-- <i class="fa fa-ellipsis-v" style="text-align: end;cursor: pointer;"></i> -->
                              <img class="mx-2 cursor-pointer" [src]="getImagesFilesUrl(message)" height="100%"
                                width="200" (click)="showImageInTab(message)" alt="Uploaded Image">
                            </ng-template>
                          </ng-template>
                          <!-- <div>{{message.message}}</div> -->
                        </div>
                      </div>
                    </div>
                    <div class="timestamp"> {{(message.created_at ? message.created_at:'') | date: 'hh:mm a'}}</div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="col-12 p-0 row m-0 py-1 d-flex justify-content-center"
            *ngIf="message.item_type == 'member_left' || message.item_type == 'member_removed' || message.item_type == 'message_date'">
            <span class="left_mem" *ngIf="message.item_type == 'member_left' ">{{(message.event_admin_id == userid?
              'you' : (message.event_user_id == userid ? 'you' : message.sender_name))}} left</span>
            <span class="left_mem" *ngIf="message.item_type == 'member_removed' ">{{(message.event_admin_id == userid ?
              'you' : message.event_admin_name)}} removed {{(message.event_user_id == userid ? 'you' :
              message.sender_name)}}</span>


            <span class="left_mem" *ngIf="message.item_type == 'message_date'"
              [attr.id]="'date-' + message.created_at">{{ message.created_at }}</span>

            <!-- <span class="left_mem" *ngIf="message.item_type == 'message_date'">{{ message.created_at }}</span> -->
          </div>

          <div class="col-12 pl-0 py-1 d-flex gap align-items-center"
            *ngIf="message.sender_id == userid && message.item_type == 'message'"
            [ngStyle]="{'justify-content' : selectedMessageOption == 'forward' ? 'space-between' : 'end'}"
            [attr.id]="'chat-item-' + message.item_id" (dblclick)="onMessageDoubleClick(message)">
            <div *ngIf="selectedMessageOption == 'forward'" class="pl-2">
              <input type="checkbox" [checked]="selectedMessages.includes(message)"
                (click)="onMessageSelect($event,message)">
            </div>
            <span *ngIf="message.deleted == '1' && message.sender_id == userid" class="delete_message"
              style="background-color: #d9fdd3 !important;">You deleted this message.</span>
            <div class="message-bubble" style="background-color: #d9fdd3 !important;" *ngIf="message.deleted != '1'">
              <div class="dropleft message_options_icon">
                <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false" (click)="externalOptionMes(message)">
                  <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                </a>
                <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                  style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('reply',message)"><i
                      class="fa fa-reply"></i> Reply</a>
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('forward',message)"><i
                      class="fa fa-share"></i> Forward</a>
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('edit',message)"
                    *ngIf="isEditenable"><i class="fa fa-pencil-alt"></i> Edit</a>
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('delete',message)"
                    *ngIf="isDelete"><i class="fa fa-trash"></i> Delete</a>
                  <a class="dropdown-item dropDownCursor message-options"
                    (click)="messageOptions('replywithmessage',message)"><i class="fa fa-reply"></i> Reply with
                    Message</a>
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('info',message)"><img
                      src="../../../assets/images/info-btn.svg" style="width: 15px;height: 15px;"> Info
                  </a>
                </div>
              </div>
              <div class="forwarded_text" *ngIf="message.forwarded == '1'"><i class="fa fa-share"></i>Forwarded</div>
              <div class="message-content">
                <div class="message-text-container">
                  <div class="replied_message" *ngIf="message.replied_message && message.replied_to_whom"
                    (click)="searchedMessageClicked(message,'rep')">
                    <!-- <span style="color: #2196F3;font-weight: 600;">{{message.replied_to_whom}}</span> -->
                    <span *ngIf="message?.replied_to_whomid != userid"
                      style="color: #2196F3;font-weight: 600;">{{message?.replied_to_whom}}</span>
                    <span *ngIf="message?.replied_to_whomid == userid"
                      style="color: #2196F3;font-weight: 600;">You</span>
                    <div class="show_text_mes">{{message.replied_message}}</div>
                  </div>
                  <!-- <pre class="m-0" [innerHTML]="formatMessage(message.content)" (copy)="onCopy($event, message.content)"></pre> -->
                  <!-- <div class="m-0 message-html" #messageDiv [innerHTML]="formatMessage(message.content)"
                    (copy)="onCopy($event, message.content)"></div> -->
                  <div class="message-text" [title]="message.content" (copy)="onCopy($event, message.content)">
                    <ng-container *ngFor="let part of message.content | highlightNumbers">
                      <!-- Render line breaks -->
                      <ng-container *ngIf="part.isLineBreak; else textPart">
                        <br />
                      </ng-container>

                      <!-- Render regular or phone text -->
                      <ng-template #textPart>
                        <span *ngIf="part.isPhoneNumber" class="mobile-number"
                          (click)="numberClicked(part.text, $event)">
                          {{ part.text }}
                        </span>
                        <span *ngIf="!part.isPhoneNumber && !part.isBold && !part.isItalic && !part.isLink">
                          {{ part.text }}
                        </span>
                        <strong *ngIf="!part.isPhoneNumber && part.isBold">
                          {{ part.text }}
                        </strong>
                        <em *ngIf="!part.isPhoneNumber && part.isItalic">
                          {{ part.text }}
                        </em>
                        <a *ngIf="!part.isPhoneNumber && part.isLink" [href]="part.text" target="_blank"
                          rel="noopener noreferrer" class="hyperlink">
                          {{ part.text }}
                        </a>
                      </ng-template>
                      <!-- <span *ngIf="part.isPhoneNumber" class="mobile-number" (click)="numberClicked(part.text,$event)">{{ part.text }}</span>
                      <span *ngIf="!part.isPhoneNumber">{{ part.text }}</span> -->
                    </ng-container>
                  </div>
                  <div class="timestamp">
                    <span *ngIf="message.edited == '1'" class="edited_text px-1">Edited</span>
                    <span *ngIf="message.edited == '1'">{{(message.updated_at?message.updated_at:'') | date: 'hh:mm
                      a'}}</span>
                    <span *ngIf="message.edited == '0'">{{(message.created_at?message.created_at:'') | date: 'hh:mm
                      a'}}</span>
                    <!-- <i class="fa fa-check-double" style="color: #2196F3;"></i> -->
                    <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"
                      *ngIf="message.item_id && message.delivery_status == '2'">
                    <img src="../../../assets/images/unread_icon.png" alt="" width="18px"
                      *ngIf="message.item_id && message.delivery_status == '1'">
                    <i class="far fa-clock" style="color: #6A7175;font-size: 12px;font-weight: 500;"
                      *ngIf="message.item_id == '' || message.item_id == undefined || message.item_id == null"></i>
                  </div>
                </div>
              </div>
            </div>
            <!-- <div>{{message.content}}</div> -->
            <!-- <div [innerText]="message.content" (click)="onCopy($event, message.content)"></div> -->
            <!-- <textarea readonly class="form-control"
                      style="white-space: pre; border: none;box-shadow:none; resize: none; background: transparent; font-family: inherit; padding: 0; width: 100% !important;"
                      rows="{{ message.content.split('\n').length }}" [value]="message.content">
                    </textarea> -->
          </div>

          <div class="col-12 pl-0 py-1 d-flex justify-content-end"
            *ngIf="message.sender_id == userid && message.item_type == 'attachment'">
            <span *ngIf="message.deleted == '1' && message.sender_id == userid" class="delete_message"
              style="background-color: #d9fdd3 !important;">You deleted this message.</span>
            <div class="message-bubble p-0" style="background-color: #d9fdd3 !important;"
              *ngIf="message.deleted != '1'">
              <div class="dropleft message_options_icon">
                <a class="more_options_down_arrow" id="more_btn1" data-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false" (click)="externalOptionMes(message)">
                  <i class="fa fa-chevron-down" style="font-size: 14px;"></i>
                </a>
                <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn1"
                  style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('reply',message)"><i
                      class="fa fa-reply"></i> Reply</a>
                  <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('forward',message)"><i
                      class="fa fa-share"></i> Forward</a> -->
                  <!-- <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('edit',message)"
                    *ngIf="isEditenable"><i class="fa fa-pencil-alt"></i> Edit</a> -->
                  <a class="dropdown-item dropDownCursor message-options" (click)="messageOptions('delete',message)"
                    *ngIf="isDelete"><i class="fa fa-trash"></i> Delete</a>
                  <a class="dropdown-item dropDownCursor message-options"
                    (click)="messageOptions('replywithmessage',message)"><i class="fa fa-reply"></i> Reply with
                    Message</a>
                </div>
              </div>
              <div class="forwarded_text" *ngIf="message.forwarded == '1'"><i class="fa fa-share"></i>Forwarded</div>
              <div class="message-content">
                <div class="message-text">
                  <div class="col-12 p-0">
                    <div class="">
                      <div class="image-container d-flex justify-content-center" style="padding: 5px;">
                        <ng-container *ngIf="message?.attachment_name?.endsWith('.pdf'); else checkImageOrVideo">
                          <div class="d-flex" style="justify-content: space-evenly;gap: 0.5rem;">
                            <div class="d-flex align-items-center"><i class="far fa-file-pdf"
                                style="color: #ff0000;font-size: xx-large;"></i></div>
                            <div class="">
                              <span style="font-size: 12px;">{{message.attachment_name}}</span>

                              <div style="font-size: 12px;">
                                <span>. PDF</span>
                              </div>

                            </div>
                            <div class="d-flex align-items-end cursor-pointer">
                              <i class="fa fa-download" (click)="downloadPDF(message)"></i>
                            </div>
                          </div>
                        </ng-container>

                        <ng-template #checkImageOrVideo>
                          <ng-container *ngIf="isVideo(message.attachment_name); else showImage">
                            <video width="200" height="100%" controls>
                              <source [src]="getImagesFilesUrl(message)" type="video/mp4">
                              Your browser does not support the video tag.
                            </video>
                          </ng-container>

                          <ng-template #showImage>
                            <img class="mx-2 cursor-pointer" [src]="getImagesFilesUrl(message)" height="100%"
                              width="200" (click)="showImageInTab(message)" alt="Uploaded Image">
                          </ng-template>
                        </ng-template>
                        <!-- <div>{{message.message}}</div> -->
                      </div>
                    </div>
                  </div>
                  <div class="timestamp">
                    <!-- <span *ngIf="message.edited == '1'" class="edited_text px-1">Edited</span>
                    <span *ngIf="message.edited == '1'">{{(message.updated_at?message.updated_at:'') | date: 'hh:mm
                      a'}}</span> -->
                    <span>{{(message.created_at?message.created_at:'') | date: 'hh:mm a'}}</span>
                    <!-- <i class="fa fa-check-double" style="color: #2196F3;"></i> -->
                    <!-- <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"> -->
                    <img src="../../../assets/images/status-dblcheck.png" alt="" width="18px"
                      *ngIf="message.delivery_status == '2'">
                    <img src="../../../assets/images/unread_icon.png" alt="" width="18px"
                      *ngIf="message.delivery_status == '1'">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="shouldShowArrow && selectedMessageOption != 'forward'" class="showArrow"><i
            class="fa fa-arrow-down icon_btn" (click)="scrollToBottom()"></i>
        </div>
      </div>

      <!-- lower Send photos and send message section  -->
      <div class="col-12 p-0 send_text row m-0" *ngIf="selectedMessageOption != 'forward'">
        <!-- to dispaly the list of selected files  -->
        <div class="col-12 p-0 row m-0">
          <div class="col-2 p-4" *ngFor="let img of imagesFiles; let i = index">
            <div class="">
              <span class="closefile"><i class="fa fa-times" (click)="removeFiles(img,i)"></i></span>
              <div class="image-container d-flex justify-content-center">
                <ng-container *ngIf="img?.name?.endsWith('.pdf'); else checkImageOrVideo">
                  <img class="mr-2 p-3" src="../../../assets/images/pdfred.png" height="150" width="150" alt="PDF Icon">
                </ng-container>

                <!-- Else, show image for JPEG/PNG -->
                <ng-template #checkImageOrVideo>
                  <ng-container *ngIf="isVideo(img?.name); else showImage">
                    <video class="mr-2 p-3" [src]="imageUrls[i]" height="150" width="150" controls>
                      Your browser does not support the video tag.
                    </video>
                  </ng-container>

                  <!-- Show image for JPEG/PNG -->
                  <ng-template #showImage>
                    <img class="mr-2 p-3" [src]="imageUrls[i]" height="150" width="150" alt="Uploaded Image">
                  </ng-template>
                </ng-template>
              </div>
              <div style="font-size: 7px;font-weight:500;display: flex;justify-content: center;">{{img?.name}}</div>
            </div>
          </div>
        </div>

        <!-- <div class="col-1 p-0 text-center " *ngIf="!isMessageBlocked">
          <span class="icon_plus cursor-pointer" (click)="addimages()">
            <i class="fa fa-plus" style="font-size: 15px;"></i>
          </span>
          <input title="Upload file smaller than 10MB" placeholder="Upload file smaller than 100MB" type="file"
            data-max-size="100000000" (change)="Imageuploads('0',$event)" class="custom-file-input"
            id="imagesFile{{'0'}}" name="filename" style="display: none;" multiple>
          <label class="custom-file-label1 file-label" for="imagesFile{{'0'}}" style="display: none;"><span>Upload
              Files</span><i class="fa fa-upload"></i></label>
        </div>
        <div class="col-10 p-0">
          <div *ngIf="selectedMessageOption == 'reply' || selectedMessageOption == 'replywithmessage'"
            class="reply_message">
            <span *ngIf="selectedOptionText?.sender_id != userid"
              style="color: #2196F3;font-weight: 600;">{{selectedOptionText?.sender_name}}</span>
            <span *ngIf="selectedOptionText?.sender_id == userid" style="color: #2196F3;font-weight: 600;">You</span>
            <div class="d-flex justify-content-between">
              <span class="show_text_mes">
                {{selectedOptionText?.content}}
              </span>
              <span class="cursor-pointer" (click)="closeReplyContent()">
                <i class="fa fa-times-circle" style="font-weight: 400;font-size: 16px;"></i>
              </span>
            </div>
          </div>
          <span *ngIf="!isMessageBlocked">
            <textarea class="form-control message_input" id="chatting_input_field" type="text"
              [(ngModel)]="send_message" autocomplete="off" placeholder="Type a Message" (keyup)="onKeyDown($event)"
              [rows]="textareaRows" (input)="adjustRows()"></textarea>
          </span>

          <span class="text-center" *ngIf="isMessageBlocked" style="color: grey;">
            <p>You can't send messages to this group because you're no longer a member.</p>
          </span>
        </div>
        <div class="col-1 p-0 text-center" *ngIf="!isMessageBlocked">
          <span class="icon_plus" (click)="sendMessage()"
            [ngClass]="{'sendBtnDisable' : ((send_message == '' || send_message == undefined || send_message == null) && imagesFiles.length == 0)}">
            <i class="fa fa-paper-plane" style="font-size: 15px; transform: rotate(50deg);"></i>
          </span>
        </div> -->

        <div class="col-12">
          <div *ngIf="selectedMessageOption == 'reply' || selectedMessageOption == 'replywithmessage'"
            class="reply_message">
            <span *ngIf="selectedOptionText?.sender_id != userid"
              style="color: #2196F3;font-weight: 600;">{{selectedOptionText?.sender_name}}</span>
            <span *ngIf="selectedOptionText?.sender_id == userid" style="color: #2196F3;font-weight: 600;">You</span>
            <div class="d-flex justify-content-between">
              <span class="show_text_mes" *ngIf="selectedOptionText?.item_type == 'message'">
                {{selectedOptionText?.content}}
              </span>

              <span class="show_text_mes" *ngIf="selectedOptionText?.item_type == 'attachment'">
                {{ selectedOptionText?.attachment_type?.startsWith('image')
                ? 'Photo'
                : selectedOptionText?.attachment_type?.startsWith('video')
                ? 'Video'
                : 'Document'}}
              </span>
              <span class="cursor-pointer" (click)="closeReplyContent()">
                <i class="fa fa-times-circle" style="font-weight: 400;font-size: 16px;"></i>
              </span>
            </div>
          </div>

          <span *ngIf="!isMessageBlocked" class="d-flex align-items-center">
            <span>
              <span class="icon_plus cursor-pointer" (click)="addimages()" style="left: 30px;bottom: 5px;">
                <i class="fa fa-plus" style="font-size: 20px;"></i>
              </span>
              <input title="Upload file smaller than 10MB" placeholder="Upload file smaller than 100MB" type="file"
                data-max-size="100000000" (change)="Imageuploads('0',$event)" class="custom-file-input"
                id="imagesFile{{'0'}}" name="filename" style="display: none;" multiple>
              <label class="custom-file-label1 file-label" for="imagesFile{{'0'}}" style="display: none;"><span>Upload
                  Files</span><i class="fa fa-upload"></i></label>
            </span>
            <textarea class="form-control message_input" id="chatting_input_field" type="text"
              [(ngModel)]="send_message" autocomplete="off" placeholder="Type a Message" (keyup)="onKeyUp($event)"
              (keydown)="onKeyDown($event)" [rows]="textareaRows"
              style="padding: .375rem 3rem !important;border-radius: 10px !important;"
              (input)="adjustRows()"></textarea>
            <span class="icon_plus" (click)="sendMessage()" style="right: 30px;bottom: 5px;"
              [ngClass]="{'sendBtnDisable' : ((send_message == '' || send_message == undefined || send_message == null) && imagesFiles.length == 0)}">
              <i class="fa fa-paper-plane" style="font-size: 20px; transform: rotate(50deg);"></i>
            </span>
          </span>

          <span class="text-center" *ngIf="isMessageBlocked" style="color: grey;">
            <p>You can't send messages to this group because you're no longer a member.</p>
          </span>
        </div>

      </div>

      <div class="col-12 d-flex justify-content-between align-items-center pt-3 row m-0"
        *ngIf="selectedMessageOption == 'forward'">
        <!-- to dispaly the list of selected files  -->
        <span class="d-flex justify-content-center align-items-center" style="gap: 1rem;font-size: 16px;"> <i
            class="fa fa-times" (click)="closeForward()"></i> {{selectedMessages?.length}} Selected</span>
        <span *ngIf="selectedMessages?.length > 0" (click)="moveToForwardModal()"> <i class="fa fa-share"
            style="font-size: 16px;"></i></span>
      </div>

    </div>

    <div class="p-0 col-8 text-center" *ngIf="!selectedPersonChat" style="background: aliceblue;">
      <img src="../../../assets/images/building_blacknwhite.svg">
    </div>

    <div class="col-3 search_mes p-0" *ngIf="isSearch == true">
      <div *ngIf="isGroupInfo == false && isMessageInfo == false">
        <div class="col-12 py-3 d-flex" style="border-bottom: 2px solid #667781;">
          <div class="col-1 p-0">
            <i class="fa fa-times cursor-pointer" style="color: #3b4a54;;" (click)="closeMessageSearch()"></i>
          </div>
          <div class="col-11 p-0">
            Search messages
          </div>
        </div>
        <div class="col-12 py-2" style="border-bottom: 1px solid #e9edef;">
          <!-- <div class="col-12 p-0"> -->
          <i class="fa fa-search mes_search_icon"></i>
          <input class="form-control search_messages" type="text" [(ngModel)]="messages_search" placeholder="Search"
            (ngModelChange)="searchMessageForChat.next($event)" autocomplete="off"
            style="border-radius: 4px ;width: 100%;height: 2.71428571em;padding: .375rem 2rem;" />
          <!-- </div> -->
        </div>

        <div class="col-12 search_messages_body"
          *ngIf=" searchedMessageList?.length == 0 && (messages_search == '' || messages_search == undefined || messages_search == null)">
          Search for messages within {{selectedPersonChat?.executives_name}}
        </div>

        <div class="col-12 search_messages_body"
          *ngIf=" searchedMessageList?.length == 0 && (messages_search != '' && messages_search != undefined && messages_search != null)">
          No messages found.
        </div>

        <div class="col-12 search_message_container" *ngIf=" searchedMessageList?.length > 0">
          <div class="p-1 cursor-pointer" style="border-bottom: 1px solid rgb(209, 206, 206);color: #878989;"
            *ngFor="let searchedMes of searchedMessageList" (click)="searchedMessageClicked(searchedMes,'search')">
            <div class="" style="font-size: 10px;color: #6A7175;font-weight: 500;">{{searchedMes.created_at | date:
              'dd/MM/yyyy'}} ,
              {{searchedMes.created_at | date: 'hh:mm a'}}</div>
            <span class="show_text_mes" style="color: #6A7175;"><img src="../../../assets/images/status-dblcheck.png"
                width="18px">
              {{searchedMes.content}}</span>
          </div>
        </div>
      </div>

      <div *ngIf="isGroupInfo == true && isMessageInfo == false">
        <div class="col 12 p-0">
          <div class="grouphoto_section">
            <div class="d-flex px-3 d-flex justify-content-between group_header">
              <span class="d-flex  align-items-center gap">
                <button type="button" class="close" (click)="closeMessageSearch()">&times;</button>
                <h4 class="m-0">Group Info</h4>
              </span>
            </div>

            <div class="d-flex justify-content-center pt-2">
              <div class="upload_pic" (click)="addProfilePhoto()">
                <i class="fa fa-users" style="font-size: 6rem;color:#878989"></i>
                <span style="position: absolute;text-align: center;color: white;" class="photo_upload_icon"><i
                    class="fa fa-camera"></i><br>Add Group Icon</span>
              </div>
              <input title="Upload file smaller than 10MB" placeholder="Upload file smaller than 10MB" type="file"
                data-max-size="10000000" (change)="uploadProfilePic('0',$event)" class="custom-file-input"
                id="customFile{{'0'}}" name="filename" style="display: none;">
            </div>

            <h4 class="pt-2 m-0 text-center" *ngIf="isEditGroupName == false">{{selectedGroupName}} <i
                class="fa fa-edit" style="color: #0B7AB2;" (click)="editGroupName(selectedGroupName)"></i></h4>
            <div class="pt-3 px-2 d-flex" *ngIf="isEditGroupName == true">
              <input type="text" class="form-control group_name" name="name" id="name" autocomplete="off"
                placeholder="Enter the Group Name" [(ngModel)]="editgroupName" #name="ngModel" required>
              <span class="edit_grp_name" (click)="updatedGroupName()"><i class="fa fa-check"></i></span>
            </div>

            <div class="text-center pt-2" style="color: #8696a0;">
              Group .{{listOfGroupMembers?.length}} members
            </div>

            <div class="px-2 pt-2 d-flex align-items-center" data-toggle="modal" data-target="#add_members_modal"
              *ngIf="isAdmin" (click)="getSelectedGroupMem()" style="border-top: 10px solid #efefef;">
              <div class="col-2 p-0"><i class="fa fa-user-plus add_members"></i></div>
              <div class="col-10 p-0"><span style="font-size: 16px;">Add Member</span></div>
            </div>

            <div class="list_group_info_mem">
              <div class="d-flex align-items-center col-12 p-0 pt-3" *ngFor="let mem of listOfGroupMembers">
                <div class="col-2 px-1 text-center">
                  <span class="icon_user">
                    <i class="fa fa-users" style="font-size: 15px;"></i>
                  </span>
                </div>
                <div class="col-8 p-0">
                  <span class="show_text_mes" style="font-size:16px">{{mem.membername}} <span class="admin_group"
                      *ngIf="mem.grouprole == '1'">Admin</span></span>
                </div>
                <div class="col-2 p-0" *ngIf="isAdmin && mem.grouprole == 2">
                  <div class="dropleft">
                    <a class="" id="more_btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fa fa-chevron-down" style="font-size: 15px;"></i>
                    </a>
                    <div class="dropdown-menu propertyBasedFilter" aria-labelledby="more_btn"
                      style="cursor:pointer; max-height: 250px;max-width: auto;overflow-y: auto;overflow-x: hidden;">
                      <a class="dropdown-item dropDownCursor" (click)="removeMemFromGroup('remove',mem)">Remove</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>



            <div class="px-2 pt-3 d-flex align-items-center add_mem_search" *ngIf="groupMemberIds.length > 0"
              (click)="removeMemFromGroup('leave',mem)">
              <div class="col-2 p-0"><i class="fa fa fa-sign-out-alt leave_group" style="color: white;"></i></div>
              <div class="col-10 p-0"><span style="font-size: 16px;">Exit Group</span></div>
            </div>

          </div>
        </div>
      </div>

      <div *ngIf="isGroupInfo == false && isMessageInfo == true">
        <div class="col-12 py-3 d-flex" style="border-bottom: 2px solid #667781;">
          <div class="col-1 p-0">
            <i class="fa fa-times cursor-pointer" style="color: #3b4a54;;" (click)="closeMessageSearch()"></i>
          </div>
          <div class="col-11 p-0">
            Message Info
          </div>
        </div>
        <div class="col-12 px-3 py-2">
          <div class="text-right message_info">
            <div class="message-bubble" style="background-color: #d9fdd3">
              <div style="font-size: 14px;">{{messageInfoDetails?.Read[0]?.content}}</div>
              <div class="text-right" style="font-size: 10px;color: #878989;">{{messageInfoDetails?.Read[0]?.created_at
                | date :'hh:mm a'}}</div>
            </div>
          </div>

          <div class="info_details_section">
            <div class="read_info pt-2" style="border-bottom: 1px solid lightgray;">
              <div><img src="../../../assets/images/status-dblcheck.png"> <span class="info_read_deli"> Read</span>
              </div>

              <div class="list_of_read" *ngFor="let read of messageInfoDetails?.Read">
                <span class="d-flex gap align-items-center py-2">
                  <span class="col-2"><img src="../../../assets/images/profileimg.png" style="width: 40px;"></span>
                  <span class="col-10 p-0">{{read.reciever_name}}
                    <div style="font-size: 10px;">{{getFormattedTime(read.read_at)}}</div>
                  </span>
                </span>
              </div>
            </div>

            <div class="delivery_info pt-2">
              <div><img src="../../../assets/images/unread_icon.png"> <span class="info_read_deli"> Delivered</span>
              </div>
              <div class="list_of_delivered" *ngFor="let read of messageInfoDetails?.Delivered">
                <span class="d-flex gap align-items-center py-2">
                  <span class="col-2"><img src="../../../assets/images/profileimg.png" style="width: 40px;"></span>
                  <span class="col-10 p-0">{{read.reciever_name}}
                    <div style="font-size: 10px;">{{getFormattedTime(read.delivered_at)}}</div>
                  </span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- loader html  -->
<div *ngIf=filterLoader class="main-lds-ring-div">
  <!-- <div class="lds-ring">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div> -->
  <img src="../../../assets/images/infinity_loader.gif">
</div>


<!-- ----------------------------Create Group Popup Modal ---------------------------- -->
<div class="modal fade" id="add_members_modal" role="dialog">
  <div class="modal-dialog create_group_modal">
    <div class="modal-content">
      <div class="modal-header align-items-center">
        <h4 class="modal-title">Add Members</h4>
        <div class="d-flex align-items-center">
          <span class="add_more_mem" (click)="addMoreMembers()"><i class="fa fa-greater-than"></i></span>
          <button type="button" class="close" data-dismiss="modal" (click)="closeGroupInfoAddModal()">&times;</button>
        </div>
      </div>
      <div class="modal-body col-12 py-0" style="overflow: auto;height: 80vh;">
        <div class="add_mem_search">
          <input class="form-control search_input" type="text" [(ngModel)]="member_name" placeholder="Search"
            (keyup)="filteraddMemExecutive()" autocomplete="off"
            style="border-radius: 3px;width: 100%;height: 2.71428571em;padding: .375rem 2rem;" />
        </div>
        <div id="filtermaindiv" class="filterspan my-2 mx-1">
          <span *ngFor="let exec of selectedGroupExecutives;let i = index">
            <div class="p-1 chip">
              {{exec.executives_name}}
              <span class="closebtn" (click)="executiveclose(i,exec)">&times;</span>
            </div>
          </span>
        </div>
        <div id="start4 group_members" *ngFor="let executive of addMembersList ; let i = index" style="margin: 10px;">
          <span class="">
            <input type="checkbox" class="mr-4 loopcheckbox creategrouphidecheckbox" id="creategroupcheckboxid"
              value="{{ executive }}" name='programmingAdd' [checked]="isSelected(executive)"
              (change)="getselectedAddMembers()" [attr.data-assign]="executive  | json" style="display: none;">
          </span>
          <span>{{executive.executives_name}}</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ----------------------------Create Group Popup Modal ---------------------------- -->


<!-- ----------------------------Forward Message Popup Modal ---------------------------- -->
<button type="button" data-toggle="modal" data-target="#forward_message_modal" id="forward_message_btn"
  style="display: none;">Show Details</button>
<div class="modal fade" id="forward_message_modal" role="dialog">
  <div class="modal-dialog create_group_modal" style="max-width: 350px !important;">
    <div class="modal-content" style="border-radius: 15px !important;">
      <div class="modal-header" style="border-bottom:none !important">
        <h4 class="modal-title">Forward To</h4>
        <div>
          <button type="button" class="close" data-dismiss="modal" id="forwardClose">&times;</button>
        </div>
      </div>
      <div class="modal-body col-12 py-0" style="overflow: auto;height: 80vh;">
        <div class="add_mem_search">
          <input class="form-control search_input" type="text" [(ngModel)]="executive_name" placeholder="Search"
            (keyup)="searchForwardMessageExecutive()" autocomplete="off"
            style="border-radius: 40px;width: 100%;height: 2.71428571em;padding: .375rem 2rem;" />
        </div>
        <div id="filtermaindiv" class="filterspan my-2 mx-1">
          <span *ngFor="let exec of selectedForwardExecutives;let i = index">
            <div class="p-1 chip">
              {{exec.executives_name}}
              <span class="closebtn" (click)="forwardExecutiveclose(i,exec)">&times;</span>
            </div>
          </span>
        </div>
        <div *ngIf="selectedForwardExecutives?.length > 0">
          <button class="btn btn-warning" type="button" style="width: 100%;" (click)="forwardMessage()">Forward</button>
        </div>
        <div id="start5 group_members" *ngFor="let executive of executivesList ; let i = index" style="margin: 10px;">
          <span class="">
            <input type="checkbox" class="mr-4 loopcheckbox forwardhidecheckbox" id="forwardcheckboxid"
              value="{{ executive }}" name='programmingForword' [checked]="isSelectedForwardExecutives(executive)"
              (change)="getselectedForwardMessagesMembers()" [attr.data-assign]="executive | json"
              style="display: none;" [disabled]="selectedForwardExecutives?.length >= 5">
          </span>
          <span class="icon_user mr-1" style="height: 30px !important;width: 30px !important;">
            <i class="fa fa-users" style="font-size: 15px;"></i>
          </span>
          <span>{{executive.executives_name}}</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ---------------------------- Forward Message Popup Modal ---------------------------- -->

<!-- Toast container -->
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" [class.show]="showToast"
  [class.hide]="!showToast"
  style="position: fixed; top: 4rem; right: 1rem; min-width: 250px; opacity: 1; transition: opacity 0.3s ease-in-out;background: #ffffff;">
  <div class="toast-header">
    <strong class="mr-auto">{{popoverNumber }} Number copied!</strong>
    <button type="button" class="ml-2 mb-1 close" aria-label="Close" (click)="showToast = false">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</div>


<!-- popover container -->
<div *ngIf="popoverNumber" class="popover"
  [ngStyle]="{'top.px': popoverPosition?.top + 10, 'left.px': popoverPosition?.left}"
  (click)="$event.stopPropagation()">
  <span style="font-size: 16px; display: flex;gap: 0.5rem;align-items: center;justify-content: center;cursor: pointer;"
    (click)="copyNumber()"><i class="far fa-copy" style="font-size: 20px;"></i> Copy Phone Number</span>
</div>